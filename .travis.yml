language: android

android:
  components:
    - tools
    - platform-tools
    - build-tools-24.0.2
    - build-tools-26.0.1
    - android-21
    - sys-img-armeabi-v7a-android-21

install:
  - echo y | sdkmanager 'cmake;3.6.4111459'
  # Create and start emulator
  - echo no | android create avd --force -n test -t android-21 --abi armeabi-v7a
  - emulator -avd test -no-skin -no-audio -no-window &

before_script:
  - cd /tmp
  - wget https://dl.google.com/android/repository/android-ndk-r16b-linux-x86_64.zip
  - unzip -q android-ndk-r16b-linux-x86_64.zip
  - export ANDROID_NDK_HOME=/tmp/android-ndk-r16b
  - curl `curl https://github.com/raozhiming/Elastos.NET.Carrier.Native.SDK/releases/latest  | grep -e "https[a-zA-Z0-9:.<>()_\/\-]*" -o`  | grep -e "/raozhiming.*android.*gz" -o >packages.txt
  - sed -i 's/^/https:\/\/github.com/g' packages.txt
  - wget -i packages.txt
  - cd $TRAVIS_BUILD_DIR/app/native-dist/libs && mkdir x86 && mkdir x86_64 && mkdir arm64-v8a && mkdir armeabi-v7a
  - tar -zxvf /tmp/*-android_x86-*.tar.gz -C x86/ lib --strip-components 1
  - tar -zxvf /tmp/*-android_x86_64-*.tar.gz -C x86_64/ lib --strip-components 1
  - tar -zxvf /tmp/*-android_arm64-*.tar.gz -C arm64-v8a/ lib --strip-components 1
  - tar -zxvf /tmp/*-android_armv7a-*.tar.gz -C armeabi-v7a/ lib --strip-components 1
  - cd $TRAVIS_BUILD_DIR

script:
  - touch ~/.android/repositories.cfg
  - gradle init
  - gradle wrapper
  - gradle lint && android-wait-for-emulator && gradle connectedAndroidTest
